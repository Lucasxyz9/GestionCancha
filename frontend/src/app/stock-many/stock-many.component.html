<div class="container">
  <h2 class="text-center mb-4">Formulario de Stock</h2>

  <form [formGroup]="stockForm" (ngSubmit)="onSubmit()">
    <div formArrayName="stocks">
      <div *ngFor="let stock of stocksFormArray.controls; let i = index" [formGroupName]="i" class="row g-3 mb-4">
        
        <!-- Producto -->
        <div class="col-md-4 form-group">
          <label [for]="'producto-' + i">Producto</label>
          <input 
            [id]="'producto-' + i"
            formControlName="nombreProducto"  
            [attr.list]="'productosList-' + i" 
            placeholder="Seleccionar Producto" 
            class="form-control" 
            [value]="getProductoNombre(i)"  
            (input)="searchProductos()" 
            (change)="selectProducto($event, i)" />
          <datalist [id]="'productosList-' + i">
            <option *ngFor="let producto of filteredProductos" [value]="producto.nombre"></option>
          </datalist>
          <div *ngIf="stock.get('nombreProducto')?.invalid && stock.get('nombreProducto')?.touched" class="text-danger">
            Producto es requerido.
          </div>
        </div>
        
        <!-- Sucursal -->
        <div class="col-md-3 form-group">
          <label [for]="'sucursal-' + i">Sucursal</label>
          <select [id]="'sucursal-' + i" formControlName="idSucursal" class="form-control">
            <option *ngFor="let sucursal of sucursales" [value]="sucursal.idSucursal">
              {{ sucursal.nombre }}
            </option>
          </select>
          <div *ngIf="stock.get('idSucursal')?.invalid && stock.get('idSucursal')?.touched" class="text-danger">
            Sucursal es requerida.
          </div>
        </div>

        <!-- Cantidad -->
        <div class="col-md-2 form-group">
          <label [for]="'cantidad-' + i">Cantidad</label>
          <input 
            [id]="'cantidad-' + i"
            formControlName="cantidad" 
            type="number" 
            placeholder="Cantidad" 
            class="form-control" />
          <div *ngIf="stock.get('cantidad')?.invalid && stock.get('cantidad')?.touched" class="text-danger">
            Cantidad debe ser mayor a 0.
          </div>
        </div>

        <!-- Precio -->
        <div class="col-md-2 form-group">
          <label [for]="'precio-' + i">Precio</label>
          <input 
            [id]="'precio-' + i"
            formControlName="precio" 
            type="number" 
            placeholder="Precio" 
            class="form-control" 
            readonly />
          <div *ngIf="stock.get('precio')?.invalid && stock.get('precio')?.touched" class="text-danger">
            Precio debe ser mayor a 0.
          </div>
        </div>

        <!-- Botón de eliminar fila -->
        <div class="col-md-1 form-group d-flex align-items-center justify-content-center">
          <button 
            type="button" 
            class="btn btn-danger btn-sm" 
            (click)="removeStockRow(i)">
            Eliminar
          </button>
        </div>
      </div>
    </div>

    <!-- Botón para agregar filas -->
    <div class="form-group text-center mt-4">
      <button type="button" class="btn btn-primary" (click)="addStockRow()">
        Agregar Fila
      </button>
    </div>

    <!-- Botón para enviar el formulario -->
    <div class="form-group text-center mt-3">
      <button 
        type="submit" 
        class="btn btn-success" 
        [disabled]="!stockForm.valid">
        Guardar
      </button>
    </div>
  </form>
</div>
